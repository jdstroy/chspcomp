"cHspComp ver.0.4.1" readme　（2008/01/07作成）

●目次

　・cHspCompとは
　・動作確認環境
　・使用条件
　・アーカイブ内容
　・新バージョンでの変更点
　・使用上の注意
　・ソースからの実行ファイル作成方法
　・インストール
　・アンインストール
　・コマンドライン書式
　・スクリプト内に[起動オプション]文字列を埋め込む
　・スクリプト内に実行ファイルのアイコンを書き換える命令を埋め込む
　・スクリプト内にコンパイル対象のスクリプト名を指定する命令を埋め込む
　・更新履歴
　・開発環境、開発に利用したツール
　・作者について


●cHspCompとは

　cHspCompは、コマンドラインランチャーやコマンドラインランチャー機能付きのエディ
　タなどからHSPスクリプトを実行／コンパイルしたり、スクリプトから実行ファイル作
　成を行うためのソフトです。実行ファイル作成時にアイコンを書き換える機能もついて
　います。


●動作確認環境

　Windows XP Pro SP2
　HSP 3.1

　このソフトを使用するにはあらかじめHSP 3.1以降がインストールされている必要があ
　ります。


●使用条件

　・このソフトはフリーウェアです。作者からは使用料等を要求しません。
　・いかなる種類の改変・他プログラムでの利用を行っても構いません。
　・このソフトを利用することによって生じた損害等について、作者は責任を負わないも
　　のとします。各自の責任においてご利用下さい。
　・オリジナルアーカイブの転載・再配布はご遠慮ください。


●アーカイブ内容

　readme.txt　 ... このファイル
　chspcomp.exe ... プログラム本体
　*.hsp　　　　... cHspCompソーススクリプト。chspcomp.exe実行時には不要です。
　　　　　　　　　 コンパイル、実行、実行ファイル作成はmain.hspから行ってくださ
　　　　　　　　　 い。


●新バージョンでの変更点

　・スクリプト内に埋め込まれた別のスクリプト名を読み取り、そのスクリプトをコンパ
　　イルする機能を追加。「●スクリプト内にコンパイル対象のスクリプト名を指定する
　　命令を埋め込む」の項目を参照。
　・/eまたは/kオプション付きで実行した時に正常に終了できなかった不具合を修正。
　・/eまたは/kオプション付きで実行した時にSpace/Enter/ESCキーでも終了できるよう
　　にした。


●使用上の注意

　・現在HSPのアーカイブには、hsp3c.hrtランタイムを使用してのデバッグ実行を行うた
　　めの実行ファイル（hsp3.exeやhsp3cl.exeと同様のもの）が含まれていないため、標
　　準エディタから「#runtime "hsp3c"」という命令を含むスクリプトを実行しようとす
　　ると、「実行用ランタイムファイルが見つかりません。」というエラーが表示され実
　　行に失敗します。cHspCompでも実行はできません。

　　hsp3cは標準のHSP3からCOM関連機能、及びgrect、grotate、gsquare命令が削除され
　　ているだけなので、これらの機能を使用しているかどうかはユーザ自身で簡単に把握
　　できるだろうという考えなのだと思います。

　　hsp3c.hrtを使用した実行ファイルは「#packopt runtime "hsp3c.hrt"」というスク
　　リプトを挿入すれば、自動作成が可能です。


●ソースからの実行ファイル作成方法

　HSP付属のスクリプトエディタで"main.hsp"を開き、[HSP]-[HSP拡張マクロを使用する]
　メニューをチェックして、[HSP]-[実行ファイル自動作成]メニューを実行。


●インストール

　・chspcomp.exeを、HSP3がインストールされているフォルダ（=hsp3.exeがあるフォルダ）
　　にコピー。

　・コマンドラインランチャーなどに登録。

　　　HSPの標準エディタに外部ツールとして登録することも可能です。以下は設定例。

　　　■ツール名　　　　　　　　　　　　　　　　　：　（任意）
　　　■ファイルパス　　　　　　　　　　　　　　　：　chspcomp.exeのフルパス
　　　■コマンドライン　　　　　　　　　　　　　　：　/m "%f"
　　　　　　　　　　　　　　　　　　　　　　　　　　　（例：実行ファイル作成）
　　　　　　　　　　　　　　　　　　　　　　　　　：　/id "%f"
　　　　　　　　　　　　　　　　　　　　　　　　　　　（例：コンパイル＋実行）
　　　　　　　　　　　　　　　　　　　　　　　　　　　（詳細は「●コマンドライン書式」参照）
　　　■作業ディレクトリ　　　　　　　　　　　　　：　（空欄）
　　　■メインメニューに表示　　　　　　　　　　　：　（任意）
　　　■ポップアップメニューに表示　　　　　　　　：　（任意）
　　　■スクリプトエディタ起動時に実行する　　　　：　OFF
　　　■実行時に編集中のファイルを上書き保存する　：　ON


　【バージョンアップの場合】

　・インストール済みのchspcomp.exeを上書き。


●アンインストール

　HSPインストールフォルダのchspcomp.exeと、同じ場所にchspcomp.exeが作成する
　chspcomp.txtを削除。


●コマンドライン書式

　【注】

　・[フルパス]に指定するスクリプトファイルの拡張子は必ず".as"か".hsp"である必要
　　があります。これ以外の拡張子のファイルはすべてオブジェクトファイルとみなされ
　　ます。オブジェクトファイルに対しては常に「実行」のみ行われます。
　・[フルパス]に半角スペースが含まれる場合は""で囲む。
　・[起動オプション]はHSP付属エディタの「起動オプション」ダイアログに入力する場合
　　と同じものを指定する。省略可。
　・chspcomp.exe自体へのオプションは[フルパス]より前でまとめて指定する。
　・実行ファイル作成は自動のみ。
　・作成されるオブジェクトファイルの中身は「実行ファイル自動作成」で作られるもの
　　と同じです。
　・実行ファイル、およびオブジェクトファイルはスクリプトがあるフォルダに作成され
　　ます。同名のファイルは上書きされます。


　■スクリプトのコンパイル＋実行

　　chspcomp.exe /hwid [スクリプトのフルパス] [起動オプション]

　　　/h = 拡張マクロを使用せずにコンパイル
　　　/w = デバッグウィンドウ常時表示フラグを追加してコンパイル
　　　/i = デバッグ情報を追加してコンパイル
　　　/d = デバッグモードシンボル(_debug)を追加してコンパイル

　　●オプションはすべて任意です。
　　●作成されるオブジェクトファイル名は"obj"固定です。

　　●コマンドプロンプトから起動する場合の入力例
　　　　（カレントフォルダにchspcomp.exeがある場合）

　　　chspcomp c:¥test¥scr.hsp
　　　chspcomp /wid "c:¥test 1¥scr.hsp" arg1
　　　chspcomp /h c:¥test¥scr.as "arg 2"


　■スクリプトのコンパイルのみ

　　chspcomp.exe /o [スクリプトのフルパス]

　　　/o = "obj"という名前でコンパイル（必須）

　　chspcomp.exe /c [スクリプトのフルパス]

　　　/c = "(ファイル名).ax"という名前でコンパイル（必須）

　　chspcomp.exe /s [スクリプトのフルパス]

　　　/s = "start.ax"という名前でコンパイル（必須）

　　●上記3つのオプションは「コンパイルのみ」を行う場合にのみ、いずれか1つだけ指
　　　定して下さい。この他 /h,/w,/i,/d を同時に指定可。

　　●コマンドプロンプトから起動する場合の入力例
　　　　（カレントフォルダにchspcomp.exeがある場合）

　　　chspcomp /o c:¥test¥scr.hsp
　　　chspcomp /ch "c:¥test 1¥scr.hsp"
　　　chspcomp /swid c:¥test¥scr.as


　■オブジェクトファイル実行のみ

　　chspcomp.exe [オブジェクトファイルのフルパス] [起動オプション]

　　●chspcomp.exeへのオプションは不要です。
　　●デバッグウィンドウを表示させるには、コンパイルの時点で少なくとも/wオプション
　　　を指定しておく必要があります。

　　●コマンドプロンプトから起動する場合の入力例
　　　　（カレントフォルダにchspcomp.exeがある場合）

　　　chspcomp c:¥test¥obj
　　　chspcomp "c:¥test 1¥scr.ax" arg1
　　　chspcomp c:¥test¥start.ax "arg 1"


　■実行ファイル自動作成（コンパイル＋exe作成）

　　chspcomp.exe /m [スクリプトのフルパス]

　　　/m = 実行ファイル自動作成（必須）

　　chspcomp.exe /mh [スクリプトのフルパス]

　　　/h = 拡張マクロを使用せずにコンパイル

　　●デバッグ情報、デバッグ関連フラグは設定されません。

　　●コマンドプロンプトから起動する場合の入力例
　　　　（カレントフォルダにchspcomp.exeがある場合）

　　　chspcomp /m c:¥test¥scr.hsp
　　　chspcomp /mh "c:¥test 1¥scr.as"


　■最後に記録されたhspcmp.dllのメッセージを表示（=標準エディタの[エラー表示]）

　　chspcomp.exe /e

　　　/e = （必須）

　　●このオプション付きで実行した時に表示されるウィンドウはSpace/Enter/ESCキー
　　　でも閉じることができます。


　■HSPの予約キーワード一覧を表示

　　chspcomp.exe /k

　　　/k = （必須）

　　●このオプション付きで実行した時に表示されるウィンドウはSpace/Enter/ESCキー
　　　でも閉じることができます。


●スクリプト内に[起動オプション]文字列を埋め込む

　cHspCompではスクリプトを実行する際、スクリプト内の特定の位置にあるコメントを
　[起動オプション]文字列として認識させることができます。
　
　[起動オプション]を埋め込むには、実行するスクリプトの1行目の先頭に「;! 」（半角
　スペースを忘れずに）で始まるコメントを記述して下さい。1行目の「;! 」以降の文字
　列がすべて[起動オプション]として認識されます。
　
　（例）
　　;! /e arg1 "arg 2"
　
　この方法で指定された[起動オプション]は、cHspComp起動時にコマンドラインで指定
　されるものよりも優先されます。


●スクリプト内に実行ファイルのアイコンを書き換える命令を埋め込む

　cHspCompでは実行ファイルを作成する際、スクリプト内の特定の書式で書かれた行をア
　イコン書き換え命令として認識させることができます。

　命令を埋め込むには、実行ファイル作成を行うスクリプト内に以下の書式の行を記述し
　て下さい。

　　;#makeopt icon_rsrc "(使用するアイコンファイルのフルパスまたはファイル名)"

　　|←行頭


　【命令を使用する際の注意点】

　書式はプリプロセッサ命令風ですが、HSPはこの命令を認識できないため、コメント記
　号を含めた「;#makeopt」を命令名としています。「#」の直前に必ず「;」をつけてく
　ださい。記述する行の位置に制限はありません。

　cHspCompにこの命令を無視させたい場合は、命令よりも前にさらにコメント記号を追加
　して下さい。

　アイコンファイルのフルパスまたはファイル名は常に""で囲んでください。ファイル名
　のみを指定する場合は、アイコンファイルを実行ファイル作成を行うスクリプトと同じ
　フォルダに置いておく必要があります。

　使用できるアイコンファイルは拡張子が「.ico」で、アイコンが1つだけ含まれている
　ものに限ります。複数のアイコンを使用したい場合は、命令を複数回（行）記述して下
　さい。記述した順番でアイコンが書き込まれます。

　デフォルトのアイコンは削除されます。


●スクリプト内にコンパイル対象のスクリプト名を指定する命令を埋め込む

　cHspCompではスクリプトをコンパイル（＋実行／実行ファイル作成）する際、スクリプ
　ト内の特定の書式で書かれたコメント行をコンパイル対象のスクリプトを変更する命令
　として認識させることができます。

　これは標準エディタなどで、メイン以外のスクリプトを編集している状態から一発でコ
　ンパイルを行うための機能です。

　命令を埋め込むには、スクリプト内に以下の書式の行を記述して下さい。

　　;#startscr "(コンパイルさせたいスクリプトのフルパスまたはファイル名)"

　　|←行頭


　【命令を使用する際の注意点】

　この機能を利用する時には、コンパイルに必要なスクリプトがすべて保存済みになって
　いる必要があります。

　書式はプリプロセッサ命令風ですが、HSPはこの命令を認識できないため、コメント記
　号を含めた「;#startscr」を命令名としています。「#」の直前に必ず「;」をつけてく
　ださい。記述する行の位置に制限はありません。

　cHspCompにこの命令を無視させたい場合は、命令よりも前にさらにコメント記号を追加
　して下さい。

　スクリプトのフルパスまたはファイル名は常に""で囲んでください。ファイル名のみを
　指定する場合は、コンパイル対象のスクリプトを命令が埋め込まれたスクリプトと同じ
　フォルダに置いておく必要があります。


●更新履歴

　- ver.0.4.0 -

　　・実行ファイル作成時にスクリプト内に埋め込まれた指示にしたがってアイコンを書き
　　　換える機能を追加。
　　・HSP 3.1で作成。

　- ver.0.3.3 -

　　・スクリプトがある場所のパスが半角スペースを含んでいると、hsp3cl.exe向けスク
　　　リプトの実行に失敗する不具合を修正。
　　・HSP 3.0aで作成。

　- ver.0.3.2 -

　　・hspcmp.dllのバグ回避機能が不要になったので削除。
　　・このファイルの「使用上の注意」を更新。

　- ver.0.3.1 -

　　・オブジェクトファイルを直接実行したときに起動できないことがあるバグを修正。
　　・一部無意味なオプションを廃止。
　　・このreadmeに「使用上の注意」の項目を追加。
　　・HSP 3.0で作成。

　- ver.0.3.0 -

　　・HSP3 RC1以降専用に作り変え。
　　・コマンドラインの書式をかなり変更。
　　・HSP3 RC1で作成。

　- ver.0.2.0 -

　　・スクリプトの実行ができなかった不具合を修正。

　- ver.0.1.9 -

　　・HSP ver.2.61専用に作り変え。
　　・スクリプトをHSP CLで実行するためのコマンドラインオプションを追加。

　- ver.0.1.8 -

　　・コンパイルが正常に終了した場合にも、HSPCMP.DLLからのメッセージを保存するよ
　　　うにした。

　- ver.0.1.7 -

　　・既に作成されているオブジェクトファイル（"obj"）の実行のみを行う機能を追加。
　　・コンパイル（"obj"または"(スクリプトファイル名).ax"または"start.ax"作成）の
　　　みを行う機能を追加。
　　・一番最近に出力されたHSPCMP.DLLからのメッセージを再表示する機能を追加。
　　・履歴付き実行機能を追加。
　　・HSPキーワード一覧を表示する機能を追加。
　　・コンパイル時、HSP拡張マクロを使用しないようにする機能を追加。

　- ver.0.1.6 -

　　・スクリプト実行機能利用時、スクリプト中の特定の位置にあるコメントを[起動オプ
　　　ション]文字列として認識する機能を追加。
　　　　（「●スクリプト中に[起動オプション]文字列を埋め込む」を参照）

　- ver.0.1.5 -

　　・HSP CL ver.2.6b2にとりあえず対応。
　　・スクリプト実行機能利用時に「フルスクリーンモード」を指定するためのオプショ
　　　ンを追加。

　- ver.0.1.4 -

　　・スクリプト実行機能利用時に常にデバッグウィンドウを表示させるためのオプショ
　　　ンを追加。

　- ver.0.1.3 -

　　・ver.0.1.1、ver.0.1.2がWindows Meで正常に動作しない例を確認したため、Windows
　　　 Meでも動作する実行ファイルを同梱するようにした。

　- ver.0.1.2 -

　　・スクリプトに渡すオプション文字列を自分へのオプションとして処理してしまう不
　　　具合を修正。（それに伴いchspcomp.exeへのオプション入力ルールを若干変更）

　- ver.0.1.1 -

　　・コンパイルエラーが表示されるようにした。
　　・スクリプト実行機能利用時、オブジェクトファイル（start.ax）をhsp2.exeで実行
　　　することによって、詳しい実行時エラーとデバッグウィンドウが表示されるように
　　　した。


●開発環境、開発に利用したツール

　・Celeron 2.3GHz / 512MB RAM
　・Windows XP Pro SP2

　・Hot Soup Processor ver.3.1
　　　http://hsp.tv/


●作者について

　ハンドル：chrono
　email: lldev●nifty.com（●を@に修正して下さい）
　http://lldev.jp/
